version: '3'

vars:
  CONTROL_PLANE_IP: "192.168.0.20"

tasks:
  install-cilium:
    desc: Install Cilium CNI with Istio compatibility
    preconditions:
      - which helm
      - which kubectl
      - sh: kubectl cluster-info
        msg: "Kubernetes cluster must be accessible"
    cmds:
      - k kustomize kubernetes/bootstrap/cilium --enable-helm | k apply -f -

  uninstall-cilium:
    desc: Uninstall Cilium CNI
    preconditions:
      - which helm
    cmds:
      - echo "⚠️  Uninstalling Cilium..."
      - k kustomize kubernetes/bootstrap/cilium --enable-helm | k delete -f -
      - echo "✅ Cilium uninstalled"


  bootstrap-cluster:
    desc: Bootstrap entire cluster infrastructure
    cmds:
      - echo "🚀 Starting cluster bootstrap..."
      - task: install-cilium
      - echo "⏳ Waiting 30 seconds for Cilium to stabilize..."
